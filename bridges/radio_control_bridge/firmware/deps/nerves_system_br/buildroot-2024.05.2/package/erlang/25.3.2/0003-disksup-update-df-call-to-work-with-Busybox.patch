From 2275a2743b85c8915ff64d487cfe0fd1367424e8 Mon Sep 17 00:00:00 2001
From: Frank Hunleth <fhunleth@troodon-software.com>
Date: Tue, 5 May 2020 21:19:01 -0400
Subject: [PATCH] disksup: update df call to work with Busybox

Busybox's df doesn't support `-x` and `-l` and this removes those
options. Plus SquashFS filesystems are nice to view on Nerves so we
don't want to exclude them anyway.
---
 lib/os_mon/src/disksup.erl | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lib/os_mon/src/disksup.erl b/lib/os_mon/src/disksup.erl
index 80f833bb49..4697b09c53 100644
--- a/lib/os_mon/src/disksup.erl
+++ b/lib/os_mon/src/disksup.erl
@@ -256,7 +256,7 @@ check_disk_space({unix, irix}, Port, Threshold) ->
     check_disks_irix(skip_to_eol(Result), Threshold);
 check_disk_space({unix, linux}, Port, Threshold) ->
     Df = find_cmd("df", "/bin"),
-    Result = my_cmd(Df ++ " -lk -x squashfs", Port),
+    Result = my_cmd(Df ++ " -k", Port),
     check_disks_solaris(skip_to_eol(Result), Threshold);
 check_disk_space({unix, posix}, Port, Threshold) ->
     Result = my_cmd("df -k -P", Port),
-- 
2.25.1


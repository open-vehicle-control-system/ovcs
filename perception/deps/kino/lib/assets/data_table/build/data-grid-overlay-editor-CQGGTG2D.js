import{I as b,J as q,L as B,S as $,U as z,W as J,a as ce}from"./chunk-IM7H4ZGK.js";import{a as M,e as G,g as j,h as L}from"./chunk-37AHYJRG.js";var r=G(j(),1),V=G(ce(),1);var le=()=>t=>t.targetX,ue=()=>t=>t.targetY,fe=()=>t=>t.targetWidth,ge=()=>t=>t.targetHeight,me=()=>t=>t.targetY+10,pe=()=>t=>Math.max(0,(t.targetHeight-28)/2),Q=L("div")({name:"DataGridOverlayEditorStyle",class:"gdg-d19meir1",propsAsIs:!1,vars:{"d19meir1-0":[ue(),"px"],"d19meir1-1":[le(),"px"],"d19meir1-2":[fe(),"px"],"d19meir1-3":[ge(),"px"],"d19meir1-4":[me(),"px"],"d19meir1-5":[pe(),"px"]}});var s=G(j(),1);function ye(){let[t,o]=s.useState();return[t!=null?t:void 0,o]}function U(){let[t,o]=ye(),[n,h]=s.useState(0),[p,S]=s.useState(!0);s.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;let d=new IntersectionObserver(c=>{c.length!==0&&S(c[0].isIntersecting)},{threshold:1});return d.observe(t),()=>d.disconnect()},[t]),s.useEffect(()=>{if(p||t===void 0)return;let d,c=()=>{let{right:v}=t.getBoundingClientRect();h(y=>Math.min(y+window.innerWidth-v-10,0)),d=requestAnimationFrame(c)};return d=requestAnimationFrame(c),()=>{d!==void 0&&cancelAnimationFrame(d)}},[t,p]);let k=s.useMemo(()=>({transform:`translateX(${n}px)`}),[n]);return{ref:o,style:k}}var Re=t=>{var W,Y;let{target:o,content:n,onFinishEditing:h,forceEditMode:p,initialValue:S,imageEditorOverride:k,markdownDivCreateNode:d,highlight:c,className:v,theme:y,id:Z,cell:D,bloom:f,validateCell:l,getCellRenderer:N,provideEditor:E,isOutsideClick:ee}=t,[a,te]=r.useState(p?n:void 0),I=r.useRef(a!=null?a:n);I.current=a!=null?a:n;let[O,w]=r.useState(()=>l===void 0?!0:!(b(n)&&(l==null?void 0:l(D,n,I.current))===!1)),g=r.useCallback((e,i)=>{h(O?e:void 0,i)},[O,h]),re=r.useCallback(e=>{if(l!==void 0&&e!==void 0&&b(e)){let i=l(D,e,I.current);i===!1?w(!1):(typeof i=="object"&&(e=i),w(!0))}te(e)},[D,l]),C=r.useRef(!1),m=r.useRef(void 0),ie=r.useCallback(()=>{g(a,[0,0]),C.current=!0},[a,g]),ne=r.useCallback((e,i)=>{var R;g(e,(R=i!=null?i:m.current)!=null?R:[0,0]),C.current=!0},[g]),ae=r.useCallback(async e=>{let i=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),m.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),m.current=[0,1],i=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),m.current=[e.shiftKey?-1:1,0],i=!0),window.setTimeout(()=>{!C.current&&m.current!==void 0&&(g(i?a:void 0,m.current),C.current=!0)},0)},[g,a]),F=a!=null?a:n,[u,se]=r.useMemo(()=>{var i,R;if(q(n))return[];let e=E==null?void 0:E(n);return e!==void 0?[e,!1]:[(R=(i=N(n))==null?void 0:i.provideEditor)==null?void 0:R.call(i,n),!1]},[n,N,E]),{ref:oe,style:de}=U(),_=!0,H,T=!0,x;if(u!==void 0){_=u.disablePadding!==!0,T=u.disableStyling!==!0;let e=B(u);e&&(x=u.styleOverride);let i=e?u.editor:u;H=r.createElement(i,{isHighlighted:c,onChange:re,value:F,initialValue:S,onFinishedEditing:ne,validatedSelection:b(F)?F.selectionRange:void 0,forceEditMode:p,target:o,imageEditorOverride:k,markdownDivCreateNode:d,isValid:O,theme:y})}x=M(M({},x),de);let X=document.getElementById("portal");if(X===null)return console.error('Cannot open Data Grid overlay editor, because portal not found.  Please add `<div id="portal" />` as the last child of your `<body>`.'),null;let P=T?"gdg-style":"gdg-unstyle";O||(P+=" gdg-invalid"),_&&(P+=" gdg-pad");let A=(W=f==null?void 0:f[0])!=null?W:1,K=(Y=f==null?void 0:f[1])!=null?Y:1;return(0,V.createPortal)(r.createElement(z.Provider,{value:y},r.createElement(J,{style:$(y),className:v,onClickOutside:ie,isOutsideClick:ee},r.createElement(Q,{ref:oe,id:Z,className:P,style:x,as:se===!0?"label":void 0,targetX:o.x-A,targetY:o.y-K,targetWidth:o.width+A*2,targetHeight:o.height+K*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:ae},H)))),X)},ve=Re;export{ve as default};

---
can_networks:
  ibooster_vehicle_can:
    bitrate: 500000
    received_frames:
      - name: rod_status
        id: 0x38E
        signals:
          - name: checksum
            kind: integer
            value_start: 0
            value_length: 8
          - name: counter
            kind: integer
            value_start: 8
            value_length: 8
          - name: output_rod_target # The brake is considered to be applied when output_rod_target is greater than 575mm or brake_status.driver_brake_applied is true (or brake_status.brake_sensor_fault is true to assume worst case scenario)
            unit: mm
            value_start: 24
            value_length: 10
      - name: brake_status
        id: 0x38F
        signals:
          - name: checksum
            kind: integer
            value_start: 0
            value_length: 8
          - name: counter
            kind: integer
            value_start: 8
            value_length: 8
          - name: driver_brake_applied
            kind: enum
            value_start: 16
            value_length: 1
            values:
              0x00: False
              0x00: True
          - name: brake_sensor_fault
            kind: enum
            value_start: 17
            value_length: 1
            values:
              0x00: False
              0x00: True
          - name: ibooster_error
            kind: enum
            value_start: 19
            value_length: 3
            values:
              0x07: false
              0x00: true # To be refined with concrete values, we only know that 0x07 means "ok"
      - name: ibooster_status
        id: 0x39D
        signals:
          - name: status
            kind: enum
            value_start: 9
            value_length: 3
            values:
              - 0x00: 'off'
              - 0x01: init
              - 0x02: failure
              - 0x03: diagnostic
              - 0x04: active_good_check
              - 0x05: ready
              - 0x06: actuation
          - name: driver_brake_apply
            kind: enum
            value_start: 22
            value_length: 2
            values:
              - 0x00: not_init_or_off
              - 0x01: brakes_not_applied
              - 0x02: driver_applying_brake
              - 0x03: fault
  ibooster_yaw_can:
    bitrate: 500000
    received_frames:
      # - name: ibooster_alert_matrix -> Multiplexed frame containing 175 flags. Not supported in cantastic yet.
      #   id: 0x35D
      # - name: ibooster_info -> uild and bootloader info, not really interesting
      #   id: 0x32D
    emitted_frames:
      - name: vehicle_status # Validated
        id: 0x38B
        frequency: 10 # Not verified, 20ms mentionned in comment
        signals:
          - name: checksum # lut_checksum(dat, 8, crc8_lut_1d);
            kind: integer
            value_start: 0
            value_length: 8
          - name: counter # cycling between 0 to 15 (0x0F)
            kind: integer
            value_start: 8
            value_length: 8
          - name: filler1 # P_EST_MAX + 2 zeros in Ocelot
            kind: static
            value: 0x00
            value_start: 16
            value_length: 10
          - name: vehicle_speed # /!\ In ocelod, P_EST_MAX_QF is ored with the 6th bit of vehicle speed /!\ (see line 632)
            value_start: 26
            value_length: 14
            scale: 1.777777778 # based on ESP_vehicleSpeed = ((current_speed*16) / 9), but, not sure current_speed is in Km/h
          - name: filler2 # VEHICLE_QF(=1) | (IGNITION_ON(=0) << 3U); in Ocelot
            kind: static
            value: 0x01
            value_start: 40
            value_length: 8
          - name: filler3
            kind: static
            value: 0x00
            value_start: 48
            value_length: 16
      - name: brake_request
        id: 0x38C
        frequency: 10 # Frequency unknown and undocummented
        signals:
          - name: checksum
            kind: integer
            value_start: 0
            value_length: 8
          - name: counter
            kind: integer
            value_start: 8
            value_length: 8
          - name: pedal_limit_external? # p_limit_external & 0xFF;
            value_start: 16
            value_length: 9
          - name: filler1
            kind: static
            value: 0x00
            value_start: 25
            value_length: 3
          - name: q_target_ext?
            value_start: 28
            value_length: 16
          - name: q_target_ext_qf
            value_start: 44
            value_length: 4
          - name: filler2
            kind: static
            value: 0x00
            value_start: 48
            value_length: 16
      - name: vehicle_alive # Validated
        id: 0x38D
        frequency: 10 # Frequency unknown and undocummented
        signals:
          - name: checksum
            kind: integer
            value_start: 0
            value_length: 8
          - name: counter
            kind: integer
            value_start: 8
            value_length: 8
          - name: filler1
            kind: static
            value: 0x00
            value_start: 16
            value_length: 32
          - name: filler2
            kind: static
            value: 0x20
            value_start: 48
            value_length: 8
          - name: filler3
            kind: static
            value: 0x00
            value_start: 56
            value_length: 8